<?xml version="1.0" encoding="utf-8"?>
<executable>
  <category>Tractography</category>
  <title>EM Clustering</title>
  <description>
    This module clusters a set of input trajectories into a number of bundles, generates arc length parameterization by establishing the point correspondences and reports diffusion parameters along the bundles. The module requires specification of seed trajectories(or initial centerlines) as representatives of the desired bundles. If a fiducial list is passed to the algorithm, the closest trajectories are taken as the seed trajectories. To download tutorial slides and data: http://www.nitrc.org/projects/quantitativedti/ If you use this module in your research, please make sure that you reference this article: Mahnaz Maddah, W. Eric L. Grimson, Simon K. Warfield, William M. Wells, "A Unified Framework for Clustering and Quantitative Analysis of White Matter Fiber Tracts", Medical Image Analysis, vol 12, issue 2, pp. 191-202, 2008.
  </description>
  <version>1.0</version>
  <documentation-url>
    http://www.slicer.org/slicerWiki/index.php/Modules:EMDTIClustering-Documentation-3.6
  </documentation-url>
  <license></license>
  <contributor>This module was developed by Mahnaz Maddah with help from Jim Miller, and was supported by NAC.</contributor>

  <parameters>
    <label>IO</label>
    <description>Parameters specifying data input and output</description>

    <geometry type="fiberbundle">
      <name>trajectoriesFilename</name>
      <label>Trajectories</label>
      <channel>input</channel>
      <index>0</index>
      <description>Input trajectories</description>
    </geometry>

    <geometry  type="fiberbundle">
      <name>outputClustersFilename</name>
      <label>Output Clusters</label>
      <channel>output</channel>
      <index>1</index>
      <description>Output of clustering which is a set of labeled trajectories</description>
    </geometry>

    <geometry type="fiberbundle">
      <name>centersFilename</name>
      <label>Initial Centers</label>
      <channel>input</channel>
      <longflag>initialCenters</longflag>
      <description>Initial cluster centerlines.</description>
    </geometry>

    <point multiple="true" coordinateSystem="ras">
      <name>seeds</name>
      <label>Fiducials to Pick Initial Centers</label>
      <channel>input</channel>
      <longflag>fiducials</longflag>
      <description>Input fiducials for which the closest trajectories in the input are found and serve as initial cluster centers. If initial centers are provided above, the fiducial list will be ignored. </description>
    </point>

    <geometry  type="fiberbundle">
      <name>initCentersFilename</name>
      <label>Output Initial Centers </label>
      <channel>output</channel>
      <longflag>outputInitCenters</longflag>
      <description>Returns the initial cluster centers that have been specified by the fiducials </description>
      <default>initialcenters.vtp</default>
    </geometry>

    <geometry  type="fiberbundle">
      <name>outputCentersFilename</name>
      <label>Output Final Centers</label>
      <channel>output</channel>
      <longflag>outputCenters</longflag>
      <description>Cluster centers</description>
      <default>centers.vtp</default>
    </geometry>
<!--
    <measurement>
      <name>measurement1FileName</name>
      <label>FA Measurement</label>
      <channel>output</channel>
      <longflag>outputFA</longflag>
      <description>Mean FA along the bundle</description>
      <default>measurement.mcsv</default>
    </measurement>
-->

    <boolean>
      <name>PerformQuantitativeAnalysis</name>
      <label>Perform Quantitative Analysis</label>
      <longflag>quant</longflag>
      <description>Perform tract-oriented quantitative analysis?</description>
      <default>true</default>
    </boolean> 

  <directory>
      <name>OutputDirectory</name>
      <label>Output Directory</label>
      <channel>output</channel>
      <longflag>outdirectory</longflag>
      <description>Directory in which to save features along the fibers</description>
      <default>.</default>
    </directory>

    <string>
      <name>FilePrefix</name>
      <label>File Prefix Name</label>
      <flag>f</flag>
      <longflag>prefix</longflag>
      <description>Name to use for feature files</description>
      <default>feature</default>
    </string>  
    
 

  </parameters>

  <parameters>
    <label>Clustering parameters</label>
    <description>Parameters to control clustering method</description>

    <float>
      <name>MinLikelihoodThr</name>
      <label>Compactness of Fiber Bundles</label>
      <default>3</default>
      <constraints>
        <minimum>1</minimum>
        <maximum>5</maximum>
        <step>1</step>
      </constraints>
      <flag>l</flag>
      <longflag>min_like</longflag>
      <description> This parameter controls the homogeneity of trajectories in a cluster. It defines the minimum likelihood threshold on cluster probability membership. Increase the number for more compact bundles (Range 1-5) </description>
    </float>
    <!--<boolean>
      <name>havePrior</name>
      <label>Anotomical Information</label>
      <description>Should an atlas be used in clustering</description>
      <longflag>use_atlas</longflag>
      <default>false</default>
    </boolean> -->

  </parameters>

  <parameters advanced ="true">
    <label>Advanced parameters</label>
    <description>Advanced parameters to control clustering method</description>

    <double-vector>
      <name>spacing</name>
      <label>Space resolution</label>
      <flag>s</flag>
      <longflag>res</longflag>
      <default>2.5,2.5,2.5</default>
      <description>Space resolution for Distance Map calculation</description>
    </double-vector>

    <integer>
      <name>maxNumberOfIterations</name>
      <label>Maximum Number of Iterations</label>
      <!-- <channel>input</channel> -->
      <default>5</default>
      <flag>i</flag>
      <longflag>maxIter</longflag>
      <description>Maximum number of EM iterations</description>
    </integer>


    <!--
    <float>
      <name>MinPost</name>
      <label>Minimum Posterior</label>
      <default>0.1</default>
      <constraints>
        <minimum>0.01</minimum>
        <maximum>0.9</maximum>
        <step>0.01</step>
      </constraints>
      <flag>p</flag>
      <longflag>min_post</longflag>
      <description>Minimum posterior specifies which trajectories contribute to generating new centers</description>
    </float>
    -->
    
    <float>
      <name>MaxDist</name>
      <label>Maximum Distance</label>
      <default>20</default>
      <constraints>
        <minimum>5</minimum>
        <maximum>50</maximum>
        <step>5</step>
      </constraints>
      <flag>d</flag>
      <longflag>max_dist</longflag>
      <description>Max distance (in mm) specifies an upper threshold on the distance of points which can contribute to generating new centers</description>
    </float>
  </parameters>
</executable>

