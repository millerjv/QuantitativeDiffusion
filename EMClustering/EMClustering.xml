<?xml version="1.0" encoding="utf-8"?>
<executable>
  <category>Diffusion.Tractography</category>
  <title>EM Clustering</title>
  <description>
    This module clusters a set of input trajectories into a number of bundles, generates arc length parameterization by establishing the point correspondences and reports diffusion parameters along the bundles. The module requires specification of seed trajectories(or initial centerlines) as representatives of the desired bundles. If a fiducial list is passed to the algorithm, the closest trajectories are taken as the seed trajectories. To download tutorial slides and data: http://www.nitrc.org/projects/quantitativedti/ If you use this module in your research, please make sure that you reference this article: Mahnaz Maddah, W. Eric L. Grimson, Simon K. Warfield, William M. Wells, "A Unified Framework for Clustering and Quantitative Analysis of White Matter Fiber Tracts", Medical Image Analysis, vol 12, issue 2, pp. 191-202, 2008.
  </description>
  <version>1.0</version>
  <documentation-url>
    http://www.slicer.org/slicerWiki/index.php/Modules:EMDTIClustering-Documentation-3.6
  </documentation-url>
  <license></license>
  <contributor>This module was developed by Mahnaz Maddah with help from Jim Miller, and was supported by NAC.</contributor>

  <parameters>
    <label>IO</label>
    <description>Parameters specifying data input and output</description>

    <geometry  type="fiberbundle">
      <name>outputClustersFilename</name>
      <label>Output Clusters</label>
      <channel>output</channel>
      <index>0</index>
      <description>Output of clustering which is a set of labeled trajectories</description>
    </geometry>
    
    <boolean>
      <name>population</name>
      <label>Population Study?</label>
      <description>Clustering a poulation of subjects?</description>
      <longflag>population</longflag>
    </boolean> 

    <directory>
      <name>TractsDir</name>
      <longflag>population_directory</longflag>
      <label>Tract Files</label>
      <description>Directory which includes a collection of vtk/vtp files of tracts to be studied </description>
      <default>/fs/corpus1/asset24_cluster_pilot/tracts/ped-icap_l</default>
    </directory>
    
    <geometry type="fiberbundle">
      <name>trajectoriesFilename</name>
      <label>Trajectories</label>
      <channel>input</channel>
      <longflag>trajectories</longflag>
      <description>Input trajectories</description>
    </geometry>
    
    <boolean>
      <name>use_atlas</name>
      <label>Use an atlas?</label>
      <description>Should an atlas be used in clustering</description>
      <longflag>use_atlas</longflag>
    </boolean> 

    <directory>
      <name>atlas_directory</name>
      <flag>a</flag>
      <longflag>atlas_directory</longflag>
      <label>Atlas Directory</label>
      <description>Use an atlas to seed the clustering. Atlases are specified as a directory containing the atlas description: an FA map called atlasFAMap.nhdr and set of initial centers representing the structures to cluster call atlasCenters.vtp.</description>
      <default>../Clustering/Atlas</default>
    </directory>
    
    <image>
      <name>subjectFAFilename</name>
      <label>Subject's FA Volume</label>
      <channel>input</channel>
      <longflag>fa_volume</longflag>
      <description>Subject's FA volume needs to be given if using an atlas.</description>
    </image>

    <boolean>
      <name>genu</name>
      <label>genu</label>
      <longflag>genu</longflag>
      <description>Genu bundle to be clustered?</description>
      <default>true</default>
    </boolean> 

    <boolean>
      <name>splenium</name>
      <label>splenium</label>
      <longflag>splenium</longflag>
      <description>Splenium bundle to be clustered?</description>
      <default>true</default>
    </boolean> 

    <boolean>
      <name>cingulumR</name>
      <label>cingulum(R)</label>
      <longflag>cingulumR</longflag>
      <description>Right cingulum bundle to be clustered?</description>
      <default>false</default>
    </boolean> 

    <boolean>
      <name>cingulumL</name>
      <label>cingulum(L)</label>
      <longflag>cingulumL</longflag>
      <description>Left cingulum bundle to be clustered?</description>
      <default>false</default>
    </boolean> 

    <geometry type="fiberbundle">
      <name>centersFilename</name>
      <label>Initial Centers</label>
      <channel>input</channel>
      <longflag>initialcenters</longflag>
      <description>Initial cluster centerlines. Leave it empty if you are using an atlas. </description>
    </geometry>

    <!--<point multiple="true" coordinateSystem="ras">
      <name>seeds</name>
      <label>Fiducials to Pick Initial Centers</label>
      <channel>input</channel>
      <longflag>fiducials</longflag>
      <description>Input fiducials for which the closest trajectories in the input are found and serve as initial cluster centers. If initial centers are provided above, the fiducial list will be ignored. </description>
    </point>

    <geometry  type="fiberbundle">
      <name>initCentersFilename</name>
      <label>Output Initial Centers </label>
      <channel>output</channel>
      <longflag>outputInitCenters</longflag>
      <description>Returns the initial cluster centers that have been specified by the fiducials </description>
      <default>initialcenters.vtp</default>
    </geometry>
    -->
    <geometry  type="fiberbundle">
      <name>outputCentersFilename</name>
      <label>Output Centers</label>
      <channel>output</channel>
      <longflag>output_centers</longflag>
      <description>Cluster centers</description>
      <default>centers.vtp</default>
    </geometry>
<!--
    <measurement>
      <name>measurement1FileName</name>
      <label>FA Measurement</label>
      <channel>output</channel>
      <longflag>outputFA</longflag>
      <description>Mean FA along the bundle</description>
      <default>measurement.mcsv</default>
    </measurement>
-->

    <boolean>
      <name>analysis</name>
      <label>Perform Quantitative Analysis</label>
      <longflag>analysis</longflag>
      <description>Perform tract-oriented quantitative analysis?</description>
    </boolean> 

  <directory>
      <name>OutputDirectory</name>
      <label>Output Directory</label>
      <channel>output</channel>
      <longflag>output_directory</longflag>
      <description>Directory in which to save features along the fibers</description>
      <default>.</default>
    </directory>
 
  </parameters>

  <parameters>
    <label>Clustering parameters</label>
    <description>Parameters to control clustering method</description>

    <float>
      <name>MinLikelihoodThr</name>
      <label>Compactness of Fiber Bundles</label>
      <default>3</default>
      <constraints>
        <minimum>1</minimum>
        <maximum>5</maximum>
        <step>1</step>
      </constraints>
      <flag>l</flag>
      <longflag>min_likelihood</longflag>
      <description> This parameter controls the homogeneity of trajectories in a cluster. It defines the minimum likelihood threshold on cluster probability membership. Increase the number for more compact bundles (Range 1-5) </description>
    </float>
  </parameters>

  <parameters advanced ="true">
    <label>Advanced parameters</label>
    <description>Advanced parameters to control clustering method</description>

    <double-vector>
      <name>spacing</name>
      <label>Space resolution</label>
      <flag>s</flag>
      <longflag>resolution</longflag>
      <default>2.5,2.5,2.5</default>
      <description>Space resolution for Distance Map calculation</description>
    </double-vector>

    <integer>
      <name>maxNumberOfIterations</name>
      <label>Maximum Number of Iterations</label>
      <!-- <channel>input</channel> -->
      <default>5</default>
      <flag>i</flag>
      <longflag>max_iterations</longflag>
      <description>Maximum number of EM iterations</description>
    </integer>

    <geometry  type="fiberbundle">
      <name>transformedCentersFilename</name>
      <label>Transformed Initial Centers From The Atlas</label>
      <channel>output</channel>
      <longflag>transormed_initalcenters</longflag>
      <description>Returns the transforme initial cluster centers if using an atlas </description>
      <default>transformedCenters.vtp</default>
    </geometry>
    
    <float>
      <name>samplesDistance</name>
      <label>Distance between landmarks</label>
      <default>1.0</default>
      <constraints>
        <minimum>0.1</minimum>
        <maximum>2</maximum>
        <step>0.1</step>
      </constraints>
      <longflag>samples_distance</longflag>
      <description>Specifies the distance between the landmarks in (mm) on the centers for quantitative analysis </description>
    </float>
    
    <float>
      <name>MaxDist</name>
      <label>Maximum Distance</label>
      <default>20</default>
      <constraints>
        <minimum>5</minimum>
        <maximum>50</maximum>
        <step>5</step>
      </constraints>
      <flag>d</flag>
      <longflag>max_dist</longflag>
      <description>Max distance (in mm) specifies an upper threshold on the distance of points which can contribute to generating new centers</description>
    </float>
  </parameters>
</executable>

